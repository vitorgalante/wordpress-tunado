<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@23.8.1/build/css/intlTelInput.css">
<style>
.iti {
    width: 100%;
    position: relative;
}
.iti input,
.iti input.jet-form__field {
    width: 100%;
    box-sizing: border-box;
}
.iti input.jet-form__field.text-field {
    min-height: 40px;
}
.iti__country-list {
    max-width: 300px;
}
input.error {
    border: 2px solid #e74c3c !important;
}
@media (max-width: 768px) {
    .iti input,
    .iti input.jet-form__field {
        font-size: 16px;
    }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@23.8.1/build/js/intlTelInput.min.js"></script>
<script>
jQuery(document).ready(function($) {
    
    // Fun√ß√£o para inicializar intlTelInput em um contexto espec√≠fico
    function initIntlTelInputInContext($context) {
        console.log('üîç Procurando campos em:', $context[0]);
        
        // Busca o input pelo name="pseudo_telefone"
        $context.find('input[name="pseudo_telefone"]').each(function () {
            var input = this;
            
            console.log('üì± Input encontrado:', input);
            
            // Verifica se j√° foi inicializado
            if (input.classList.contains('iti-initialized')) {
                console.log('‚è≠Ô∏è J√° inicializado, pulando...');
                return;
            }
            
            // Marca como inicializado
            input.classList.add('iti-initialized');
            
            // Busca o input oculto "telefone"
            var $form = $(input).closest('form');
            var realInput = $form.find('input[name="telefone"]')[0];
            
            if (!realInput) {
                console.warn('‚ö†Ô∏è Input oculto "telefone" n√£o encontrado');
                return;
            }
            
            console.log('‚úÖ Input oculto encontrado:', realInput);
            
            // Inicializa o intlTelInput
            var iti = window.intlTelInput(input, {
                initialCountry: "br",
                preferredCountries: ["br", "us", "pt"],
                separateDialCode: true,
                nationalMode: false,
                formatOnDisplay: true,
                autoPlaceholder: "aggressive",
                strictMode: true,
                utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@23.8.1/build/js/utils.js"
            });
            
            console.log('‚úÖ intlTelInput inicializado com sucesso!');
            
            // Fun√ß√£o para sincronizar o telefone
            function syncTelefone() {
                if (iti.isValidNumber()) {
                    realInput.value = iti.getNumber();
                    console.log('üìû Telefone sincronizado:', realInput.value);
                } else {
                    realInput.value = '';
                    console.log('‚ùå Telefone inv√°lido, campo limpo');
                }
            }
            
            // Event listeners
            input.addEventListener('input', function() {
                syncTelefone();
                input.classList.remove('error');
            });
            
            input.addEventListener('countrychange', function() {
                console.log('üåç Pa√≠s alterado');
                syncTelefone();
            });
            
            // Valida√ß√£o no submit
            $form.off('submit.intlTel').on('submit.intlTel', function(e) {
                console.log('üì§ Tentando enviar formul√°rio...');
                
                if (!iti.isValidNumber()) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    input.classList.add('error');
                    alert('Por favor, insira um telefone v√°lido.');
                    console.log('‚ùå Submit bloqueado - telefone inv√°lido');
                    return false;
                }
                
                syncTelefone();
                console.log('‚úÖ Formul√°rio v√°lido, enviando...');
            });
            
            // Sincroniza inicialmente se j√° houver valor
            if (input.value) {
                syncTelefone();
            }
        });
    }
    
    // Inicializa nos formul√°rios da p√°gina principal
    console.log('üöÄ Inicializando formul√°rios da p√°gina...');
    initIntlTelInputInContext($(document));
    
    // Event listener para popups do Elementor
    $(window).on('elementor/popup/show', function(event, id, instance) {
        console.log('');
        console.log('üéâ ========== POPUP ABERTO ==========');
        console.log('ID:', id);
        
        // Pequeno delay para garantir que o DOM foi renderizado
        setTimeout(function() {
            var $popup = $('#elementor-popup-modal-' + id);
            
            if ($popup.length) {
                console.log('‚úÖ Popup encontrado, inicializando...');
                initIntlTelInputInContext($popup);
            } else {
                console.warn('‚ö†Ô∏è Popup n√£o encontrado com ID:', id);
                // Tenta com qualquer popup vis√≠vel
                var $visiblePopup = $('.elementor-popup-modal:visible');
                if ($visiblePopup.length) {
                    console.log('‚úÖ Usando popup vis√≠vel');
                    initIntlTelInputInContext($visiblePopup);
                }
            }
        }, 200);
    });
    
    console.log('‚úÖ Script intlTelInput carregado e pronto!');
});
</script>
