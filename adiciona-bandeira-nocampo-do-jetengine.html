<!-- CSS da biblioteca intl-tel-input -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@23.8.1/build/css/intlTelInput.css">

<!-- CSS Customizado -->
<style>
/* Container principal do intl-tel-input */
.iti {
    width: 100%;
    display: block;
    position: relative;
}

/* Container da bandeira e c√≥digo do pa√≠s */
.iti__flag-container {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    z-index: 2;
}

/* Bot√£o da bandeira */
.iti__selected-flag {
    display: flex;
    align-items: center;
    padding: 0 8px 0 12px;
    height: 100%;
}

/* Ajusta o input para n√£o sobrepor a bandeira */
.iti input,
.iti input.jet-form__field {
    width: 100% !important;
    box-sizing: border-box !important;
}

/* Garante que o input tenha altura adequada */
.iti input.jet-form__field.text-field {
    min-height: 40px;
    height: auto;
}

/* Dropdown de pa√≠ses */
.iti__country-list {
    width: 100%;
    max-width: 300px;
    z-index: 9999;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-radius: 4px;
    margin-top: 4px;
}

/* Estilo para o campo com erro */
input.error {
    border: 2px solid #e74c3c !important;
}

/* C√≥digo do pa√≠s separado */
.iti__selected-dial-code {
    margin-left: 6px;
    font-weight: 500;
}

/* Seta do dropdown */
.iti__arrow {
    margin-left: 6px;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
    border-top: 4px solid #555;
}

/* Responsivo para mobile */
@media (max-width: 768px) {
    .iti input,
    .iti input.jet-form__field {
        font-size: 16px; /* Evita zoom no iOS */
    }
}
</style>

<!-- JavaScript da biblioteca intl-tel-input -->
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@23.8.1/build/js/intlTelInput.min.js"></script>

<!-- Script de inicializa√ß√£o -->
<script>
(function () {

    function initContainer(container) {

        const pseudoInput = container.querySelector(
            'input[name="pseudo_telefone"]'
        );
        if (!pseudoInput || pseudoInput.dataset.intlInitialized) return;

        const form = pseudoInput.closest('form');
        if (!form) return;

        const realInput = form.querySelector(
            'input[name="telefone"]'
        );
        if (!realInput) return;

        pseudoInput.dataset.intlInitialized = 'true';

        const iti = window.intlTelInput(pseudoInput, {
            initialCountry: "br",
            preferredCountries: ["br", "us", "pt"],
            separateDialCode: true,
            autoPlaceholder: "aggressive",
            formatOnDisplay: true,
            nationalMode: false,
            strictMode: true,
            utilsScript:
                "https://cdn.jsdelivr.net/npm/intl-tel-input@23.8.1/build/js/utils.js",
        });

        function syncTelefone() {
            if (!iti.isValidNumber()) {
                realInput.value = '';
                return;
            }
            realInput.value = iti.getNumber();
        }

        pseudoInput.addEventListener('input', syncTelefone);
        pseudoInput.addEventListener('countrychange', syncTelefone);

        form.addEventListener('submit', function (e) {
            if (!iti.isValidNumber()) {
                e.preventDefault();
                e.stopPropagation();
                pseudoInput.classList.add('error');
                alert('Por favor, insira um n√∫mero de telefone v√°lido.');
                return false;
            }
            syncTelefone();
        });

        pseudoInput.addEventListener('input', function () {
            pseudoInput.classList.remove('error');
        });
    }

    function scanAndInit(root) {
        const containers = root.querySelectorAll(
            '.jet-form-field-container.phone-international'
        );
        containers.forEach(initContainer);
    }

    // üîç inicializa o que j√° existir
    document.addEventListener('DOMContentLoaded', function () {
        scanAndInit(document);
    });

    // üëÅ observa mudan√ßas no DOM (ESSENCIAL)
    const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
            mutation.addedNodes.forEach(node => {
                if (node.nodeType !== 1) return;

                if (node.matches && node.matches('.jet-form-field-container.phone-international')) {
                    initContainer(node);
                } else if (node.querySelectorAll) {
                    scanAndInit(node);
                }
            });
        });
    });

    observer.observe(document.body, {
        childList: true,
        subtree: true
    });

})();
</script>

